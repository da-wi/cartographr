---
title: "Creating multiple posters"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Creating posters}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  echo=TRUE,
  message=FALSE,
  warning=FALSE,
  collapse = TRUE,
  comment = "#>"
)
```

This vignette shows how to create _multiple_ posters (or also postcards, when used with larger output formats) at once.

```{r setup}
library(cartographr)
library(dplyr)
```

# Setup the map parameters.

We have to provide `longitude`, `latitude`. Furthermore, we define the extend of the OSM data in meters in `get_osmdata`. Here, we will use a map width of 1200 _m_. Also, in this example we will create several instances for different maps (cities).

```{r define coordinates}
cartographr::set_output_size("A6")

df_coords <- tibble(lat = c(48.873, 53.545,47.374),
       lon = c(2.2950,10.000,8.538),
       x_distance = rep(1200,3),
       name = c("paris","hamburg","zÃ¼rich"),
       color = c("tropical","autumn", "imhof"))

df_coords |> head()
```

Having defined our input data, we can feed it into the `get_osmdata()` function. 

```{r retrieve data}
df_coords <- df_coords |> 
  # create rowwise() grouping
  rowwise() |>
  # retrieve osm data
  mutate(osm = list(get_osmdata(lat, lon, x_distance)))

df_coords |> head()
```

# Plot map

Now, we create ggplot2 objects for each city with an `osm` list. 

```{r plot map}
df_coords <- df_coords |> 
  mutate(output = list(
    plot_map(osm, palette = color)+
    theme_poster_poppins()+ 
    ggplot2::theme(plot.background = ggplot2::element_rect(fill="#FFFFFE", 
                                                  color="#AAAAAA"))+
    ggplot2::labs(title = name)
    )
  ) 
```

```{r print a poster, fig.dim=c(5,7), fig.dpi=72}
# Print out the first poster
df_coords$output[[1]]
# Print out the second poster
df_coords$output[[2]]
# Print out the third poster
df_coords$output[[3]]
```

# Save posters

```{r save map, eval=F}
df_coords |> 
    mutate(res = save_map(plot = output,
                          filename = paste0("~/postcards/",name,"_A6_",color,".pdf")))
```
