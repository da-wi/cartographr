---
title: "Creating postcards"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Creating postcards}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  echo=TRUE,
  message=FALSE,
  warning=FALSE,
  collapse = TRUE,
  comment = "#>"
)
```

This vignette shows how to create postcards (or also posters, when used with larger output formats).

```{r setup}
library(cartographr)
library(dplyr)
```

# Setup the map parameters.

We have to provide `longitude`, `latitude`. Furthermore, we define the extend of the OSM data in meters in `get_osmdata`. Here, we will use a map width of 1200 _m_. Also, in this example we will create several instances for different maps (cities).

```{r define coordinates}
osmdata::get_overpass_url()
#osmdata::set_overpass_url("https://overpass.kumi.systems/api/interpreter")
osmdata::set_overpass_url("https://overpass-api.de/api/interpreter")
 	
cartographr::set_output_size("A6")

df_coords <- tibble(lat = c(48.873810503366016, 53.54514883288921,47.374566535402685),
       lon = c(2.2950207999211405,10.000039228206994,8.538175481044222),
       x_distance = rep(1200,3),
       name = c("paris","hamburg","zÃ¼rich"),
       color = c("tropical","autumn", "imhof"))

df_coords |> head()
```

Having defined our input data, we can feed it into the `get_osmdata()` function. Afterwards, we directly preprocess the maps using `preprocess_map()` and store it in a new column called `osm_pps`. 

```{r retrieve data}
df_coords <- df_coords |> 
  # create rowwise() grouping
  rowwise() |>
  # retrieve osm data
  mutate(osm = list(get_osmdata(lat, lon, x_distance)))

df_coords |> head()
```

# Plot map

Now, we create ggplot2 objects for each prepocssed `osm_pps` object. 

```{r plot map}
df_coords <- df_coords |> 
  mutate(output = list(
    plot_map(osm, palette = color)+
    theme_poster_poppins()+ 
    ggplot2::theme(plot.background = ggplot2::element_rect(fill="#FFFFFE", 
                                                  color="#AAAAAA"))+
    ggplot2::labs(title = name)
    )
  ) 
```

```{r print a postcard, fig.dim=c(5,7), fig.dpi=72}
df_coords$output
```

# Save map

```{r save map, eval=F}
df_coords |> 
    mutate(res = save_map(plot = output, filename=paste0("~/postcards/",name,"_A6_",color,".pdf")))
```
